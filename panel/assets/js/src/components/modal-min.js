var Modal=function(n){var o=$('<div class="modal" tabindex="0"></div>'),t=function(){return $(".modal").length>0},e=function(){c();var e=$(".modal-content");e.shortcuts(),e.center(48),e.find(".btn-cancel").on("click",function(){if($(".modal").length)return a(),!1}),e.on("click",function(n){n.stopPropagation()}),e.find(".message").on("click",function(){e.find(".field-with-error").removeClass("field-with-error"),$(this).remove()});var i=e.find(".form");t()||i.data("autosubmit","native"),Form(i,{focus:!0,redirect:function(o){if("object"==$.type(o)){if(o.url)return $(".modal").remove(),$("body").addClass("loading"),void n.content.open(o.url,function(){$("body").removeClass("loading")});if(o.content)return void r(o.content)}window.location.reload()}}),o.trigger("setup")},c=function(){n.delay.stop(),$(document).off("keyup.modal"),$(window).off("resize.modal"),$.shortcuts.reset()},i=function(t,c){$(document).trigger("click.contextmenu"),a(),n.content.off(),n.load(t,"modal",function(n){o.html(n.content),$("body").append(o),o.on("click",function(){a()}),"function"==$.type(c)&&c(),e()})},r=function(n){$(".modal-content").parent().html(n),e()},a=function(){if(n.content.scroll.save(),!n.hasModal())return!0;c(),$(".modal").remove(),n.content.on()};return{root:o,open:i,close:a,replace:r,form:function(){return $(".modal-content form")},setup:function(){n.hasModal()&&e()}}};