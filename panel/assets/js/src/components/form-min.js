var Form=function(e,a){var e=$(e);e.off();var t={focus:!1,returnTo:!1,url:e.attr("action"),redirect:function(e){},submit:function(e){}},i=$.extend({},t,a);if(e.find("[data-focus=true]").fakefocus("input-is-focused"),e.find("[data-field]").each(function(){var e=$(this),a=e.data("field");e[a]&&e[a]()}),e.data("keep")&&(e.on("keep",function(){$.post(e.data("keep"),e.serializeObject())}),e.on("change.keep",":input",function(){e.trigger("keep")})),i.focus&&e.find("[autofocus]").focus(),"native"==e.data("autosubmit"))return!0;e.find(".btn-addit").on("click",function(){e.attr("action",$(this).data("action"))}),e.on("submit",function(a){return!e.hasClass("loading")&&(e.addClass("loading"),0==e.data("autosubmit")?void a.preventDefault():(i.submit(e),e.find(".field-with-error").removeClass("field-with-error"),app&&app.isLoading(!0),$.post(e.attr("action"),e.serializeObject(),function(a,t,n){app&&app.isLoading(!1),e.removeClass("loading"),i.redirect(a)}).error(function(a,t){app&&app.isLoading(!1),e.removeClass("loading"),a.responseJSON&&a.responseJSON.message?alert(a.responseJSON.message):alert("An unexpected error occurred")}),!1))})};