!function($){var e=function(e,t){var n=this;return this.element=$(e),this.customDropdown=!!t,this.dropdown=t?$(t):$('<div class="autocomplete"></div>').hide(),this.entered=!1,this.lastSearch=!1,this.cache=!1,this.limit=this.element.data("limit")||5,this.url=this.element.data("url"),this.sticky=this.element.data("sticky"),this.ignored=[],this.keys=function(e,t){e.on("keydown",function(e){if(t[e.keyCode])return t[e.keyCode]()})},this.highlight=function(e,t){var n=new RegExp("^"+t,"gi");return e.replace(n,function(e){return"<strong>"+e+"</strong>"})},this.data=function(e){return $.isArray(n.url)?e(n.url):(n.cache||$.post(n.url,function(t){"object"==$.type(t)&&t.data&&(n.cache=t.data,e(t.data))}),e(n.cache))},this.add=function(e){n.element.val(e).focus(),n.lastSearch=e,n.close(),n.focus(),n.element.trigger("autocomplete:add")},this.close=function(e){e||(e=!0),n.dropdown.empty().hide(),n.element.trigger("autocomplete:close")},this.focus=function(){n.element.trigger("focus")},this.ignore=function(e){var e=e.toLowerCase();-1==$.inArray(e,n.ignored)&&n.ignored.push(e)},this.unignore=function(e){var e=e.toLowerCase();n.ignored=$.grep(n.ignored,function(t){return t!=e})},this.search=function(e){return e==n.lastSearch||(n.dropdown.empty(),n.dropdown.hide(),n.lastSearch=e,0==e.length?(n.element.trigger("autocomplete:empty"),!1):(n.element.trigger("autocomplete:search"),void n.data(function(t){var o=$.grep(t,function(t){var o=t.toLowerCase(),r=e.toLowerCase();return 0==o.indexOf(r)&&-1==$.inArray(o,n.ignored)});if(o=o.slice(0,n.limit),0==o.length)return n.dropdown.hide(),n.element.trigger("autocomplete:noresults"),!1;if($.each(o,function(t,o){var r=$('<button type="button">'+n.highlight(o,e)+"</button>");r.on("click",function(){return n.add(o),!1}),n.keys(r,{13:function(){return n.add(o),!1},27:function(){return n.close(),n.focus(),!1},38:function(){return n.go(t-1),!1},40:function(){return n.go(t+1),!1},8:function(){return n.close(),n.focus(),!1}}),n.dropdown.append(r)}),n.sticky){var r=n.element.position();r.top=r.top+n.element.outerHeight(),n.dropdown.css(r)}n.dropdown.show(),n.elements=n.dropdown.find("button"),n.element.trigger("autocomplete:search")})))},this.go=function(e){if(-1==e||!n.elements)return!1;n.elements.eq(e).focus()},this.init=function(){return $(document).on("click",function(){n.close()}),n.dropdown.on("click",function(e){e.stopPropagation()}),n.element.attr("autocomplete","off"),n.customDropdown||n.element.after(n.dropdown),n.lastSearch=n.element.val(),n.element.on("keyup",function(e){13!=e.keyCode&&n.search(n.element.val())}),n.keys(n.element,{40:function(){return n.go(0),!1},27:function(){return n.close(),!1}}),{ignore:n.ignore,unignore:n.unignore,search:n.search,close:n.close}},this.init()};$.fn.autocomplete=function(t){return this.each(function(){if($(this).data("autocomplete"))return $(this).data("autocomplete");var n=new e(this,t);return $(this).data("autocomplete",n),n})}}(jQuery);